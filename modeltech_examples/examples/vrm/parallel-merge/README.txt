The process of merging UCDBs files generated from simulations can be a
time consuming task especially if done once all UCDBs files are
available. Using "vcover merge" to merge files produces a linear
relationship with time, the number of tests and the number of coverage
bins involved in the coverage model. Merging ten UCDB files with a
constant coverage model will take approx twice as long as merging five UCDB
files. The merge process within Questa has been architected to allow
any number of UCDBs to be merged together and any number of merged
UCDBs to be merged together to produce a final result. This means that
it is a process that can benefit from the ability to run merges in
parallel to improve the overall merge time.

Questa's Verification Run Management (VRM) system not only allows
regressions to be captured, controlled, run and managed but it also
allows any actions to be automated. As well as this ability to automate
it also has in-built merging technology and grid integration. Any user
of VRM is able to benefit from an intelligent merge capability that triggers
merging based on the results of simulations and tasks as the
regression is running. This means that at the end of the regression
run the VRM user has a UCDB file merged with all the information they
require for analysis. Some of this inbuilt intelligence can also be
used by users who do not use VRM to run their regressions. The examples
in this directory show how the provided configuration file or RMDB can be
used to enable the user to carry out parallel merging automatically on
a list of UCDB files or one generated by searching a certain directory
or directory structure.

REQUIREMENTS

There are a couple of requirements for the set-up and successful use
of the parallel merge process. Firstly you will require the running of
VRM, this is a standard part of the Questa install but requires a
license feature called 'qvrm'. The feature is available with Questa SV
and ABV, Questa Prime and Ultra or as an option to Questa Core called
Questa Verification Management. Next you will require access to the 
'parallel_merge.rmdb' file which is the Run Manager Database file with the
configuration to use VRM to do the parallel merge. This file can be 
found in the vm_src/parallel_merge directory of the install, it can be
placed within the directory that you are working or left were it is being
the -rmbd switch of 'vrun' (the VRM executable) needs to point to
the location of this file.

MODES OF OPERATION

The parallel merge process can be run in three main modes of operation and
the examples directory has an example of each of them at
examples/vrm/parallel-merge. These modes are as follows with the directory
 holding further details and instructions;

Directory         Mode

multi-core        Run Locally on a machine with multiple cores available.
remote-shell      Run using rsh to remotely execute merges on defined machines.
grid              Run using grid software such as SGE (Sungrid) or LSF.

DESCRIPTION OF THE PARALLEL MERGE PROCESS

There are three stages to the parallel merge process as configured in the 
supplied RMDB file. Firstly a UCDB file list is built or supplied that
contains a list of UCDB files to be merged. Next the original file list is
split into a certain number of level one merges, depending on parameters set
in the RMDB this split of the complete job will run either locally, via remote
shell or on a grid. Lastly the UCDBs generated by the level one merges are
managed by VRMs auto-merge algorithm that generates merge processes from the
UCDB files that are added to its merge queue as the first level merges are
completed. 

If the filelist is supplied then the UCDB files and their full absolute paths
need to appear one per line of the text file. If the file list is to be built
then the user is able to set a directory path with the parameter UCDBDIR and a
search name with the parameter UCDBFILENAMES. By default the search directory
is set to the current directory, and he search string is set to Test*.ucdb.
All files found recursively from this directory will be added into the file
list as the UCDBs that need to be merged. Another parameter called TESTSTATUS
can then be set to one of three values, all, failed or passed. This causes a
parse of all the UCDBs in the file list to build a new list for merging based
on the TESTSTATUS in the test record of each UCDB. All means all tests will be
added to the list used, passed means only the TESTSTATUS results of Note and
Warning will be added to the list and finally failed means that only
TESTSTATUS results of Error and Fatal will be used.

Once the file list has been built the next stage is to split the list into
level one merges. The number used to list the list depends on the mode of
operation. For a mode of local and grid the number of jobs that the list is
split into is set by the JOBS parameter. For a mode of rsh the number of jobs
is set by the number of entries in the HOSTNAMES parameter. Once the complete
job has been split into the number of jobs required then the level one merges
are launched using the method set by the MODE parameter. The actual number of
jobs launched can be further controlled by the -j switch when using local mode,
when using a grid the parameter GRIDSLOTS controls the number of jobs that
will run concurrently.

When the level one merges complete a UCDB file will be generated and the ucdbfile
parameter will be used to communicate with VRM that the level one merge is ready to
be merged with the other results. VRM's auto-merge then takes over to ensure
that all the resulting UCDB files from the level one merges are merged into
the final UCDB merge file. The parameter MERGEOPTIONS can be set to add
additional switches to the vcover merge process.

DEFINITION OF THE CONTROL PARAMETERS IN THE RMDB

"MODE" valid values "local", "rsh", "lsf" or "sge", default "rsh" -
This controls what system the process will use to run the merge tasks.

"GENFILELIST", valid values "yes" or "no", default "yes" - This can be
set to either "yes" or "no" and controls if a "filelist" is generated
before the merge process starts. If this is set to "yes" then the
parameters UCDBDIR and UCDBFILENAMES are used see below.

"FILELIST", set to valid filename, default "filelist" - This controls
the name of the 'filelist' filename that is read and used as the list
of files to be merged.

"FILELISTLOCATION", set to valid path and filename, default
(%VRUNDIR%)/(%FILELIST%) which is the directory that vrun is run from 
- This allows the path and filename of the filelist to be changed, the
path needs to be absolute. The default is to take the FILELIST filename
and locate it in the directory that the you run vrun.

"TESTSTATUS", valid values "all", "passes" or "failures", default "all"
- This can be used to optimize the supplied filelist to only merge
passes or failures. When set to passes UCDBs with a TESTSTATUS of
"note" or "warning" will be merged, when set to failures UCDBs with a
TESTSTATUS of "error" or worst will be merged. The default is to merge
all UCDBs in the filelist.

"UCDBDIR", set to valid pathname, default (%VRUNDIR%) - This controls
the directory that will be used to search recursively for UCDB files
to generate the 'filelist'. It defaults to the absolute path that vrun is run
from.

"UCDBFILENAMES", set to valid filename search, default "Test*.ucdb" -
This controls the match that will be used to location the UCDB files
in UCDBDIR. 

"QUEUETIMEOUT", this value is used for time-outs and is measured between
the time that a merge action is launched to the time it actual starts
to execute. This is all managed automatically and if the queueing time
over runs the QUEUETIMEOUT value the actions will be seen as failed
and the system will no longer wait for the action to be started. This
needs to be set to the maximum time you would be prepared to wait before
assuming that a merge action will not run for some reason, it defaults to 
6000 seconds.

"MERGETIMEOUT", this value is used for time-outs and is measured between
the time that a merge action starts to the time the action finishes.
This is all managed automatically and if the run time
over runs the MERGETIMEOUT value the actions will be seen as failed
and the system will no longer wait for the action to be started. This
needs to be set to the maximum time you would expect the longest merge
operation to take plus some buffer time, it defaults to 6000 seconds.

"mergefile", set to valid filename, default (%VRUNDIR%)/merge.ucdb -
This controls the name of the merge file that will be produced from
the merge process. This is a special VRM parameter and is the one that
enables the merge queue functionality within VRM. It defaults to
output the merge file in the directory where vrun was run.

"mergeoptions", set to valid switches for vcover merge, default
"-testassociated" - This controls the switches that should be added to
the vcover merge process. It gives the user the opportunity to add
switches used in their flow.

"COMMANDLINE", this is an internal parameter do not change - It is
used to work out the command line used to run the current merge process.
The command line is printed as part of the run to make it easy to repeat
another parallel merge with the same parameters set. This is useful in the
-ask switch has been used on the first time and the parameters have
been set interactively.

"DATABASES", special parameter do not change - This calculates the
number of databases to merge by opening the 'filelist' and counting
the UCDB files.

"GROUPS", special parameter do not change - This calculates the number
of first level merges that are required and will depend on the mode of
the merge and the number of databases to merge. If 'rsh' mode is set
then the number of groups will be the number of hosts listed in the
HOSTNAMES parameter. If the number of databases to merge is less than
1 times the number of HOSTNAMES then the number of groups will be
reduced to ensure that there are no groups with zero databases. If one
of the grid modes is selected then the groups are calculated from the
JOBS parameter.

"HOSTNAMES", set to a list of valid hosts, default "dvtvnc9 dvtvnc10
dvtvnc11 dvtvnc9 dvtvnc10 dvtvnc11" - This controls the hosts that
will accept the 'rsh' jobs. It should be set to a list separated by
spaces or commas. Including the name of the host in the list twice
means that multiple jobs can be run on the host. This is useful for
multi CPU hosts where you want to run more than single first level
merges.

"HOST", special parameter do not change - This is used to generate a
hostname for each 'rsh' process. It is used by each first level merge
as well as the merge processes generated by VRM when the first level
merges start to complete.

"RSHJOBS", special parameter do not change - This is used to generate
the number of 'rsh' jobs based on the number of HOSTNAMES available,
it is passed into the GROUPS parameter to calculate the number of
groups to generate for first level merges.

JOBS, set to the number of jobs that the merge should be split
into default "10" for grid and "2" for local mode - This controls
the number of grid jobs you want the merge process to be split into
when using one of the grid modes or local mode.

GRIDLSLOTS, set to the number of slots that are to be used on the grid,
this sets the maximum number of running jobs on the method, and therefore
the number of parallel merge actions that will be running in parallel 
on the grid.

See each of the example directories for a runnable example of each type
of parallel merge. The RMDB from the install is a starting point and
with knowledge of the VRM system can be modified to customize if
required. The directories are multi-core, remote-shell and grid.
Change into one of these to run the example you are interested in using.

